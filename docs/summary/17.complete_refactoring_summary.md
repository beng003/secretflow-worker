# SecretFlowä»»åŠ¡æ¨¡å—å®Œæ•´é‡æ„æ€»ç»“

## é‡æ„æ¦‚è¿°

**å®Œæˆæ—¥æœŸ**: 2026-01-05  
**é‡æ„èŒƒå›´**: 
- Preprocessingé¢„å¤„ç†ä»»åŠ¡æ¨¡å—
- Statsç»Ÿè®¡åˆ†æä»»åŠ¡æ¨¡å—
- Evaluationæ¨¡å‹è¯„ä¼°ä»»åŠ¡æ¨¡å—
- Testsæµ‹è¯•ç›®å½•ç»“æ„

## ä¸€ã€Preprocessingé¢„å¤„ç†ä»»åŠ¡æ¨¡å—é‡æ„

### é‡æ„æˆæœ

åˆ›å»ºäº†æ¨¡å—åŒ–çš„é¢„å¤„ç†ä»»åŠ¡ç»“æ„ï¼Œå®ç°äº†7ä¸ªé¢„å¤„ç†ä»»åŠ¡ï¼š

```
src/secretflow_task/jobs/preprocessing/
â”œâ”€â”€ scaler/                              # æ•°æ®ç¼©æ”¾
â”‚   â”œâ”€â”€ standard_scaler_task.py          # æ ‡å‡†åŒ–
â”‚   â””â”€â”€ minmax_scaler_task.py            # å½’ä¸€åŒ–
â”œâ”€â”€ encoder/                             # æ•°æ®ç¼–ç 
â”‚   â”œâ”€â”€ label_encoder_task.py            # æ ‡ç­¾ç¼–ç 
â”‚   â””â”€â”€ onehot_encoder_task.py           # ç‹¬çƒ­ç¼–ç 
â”œâ”€â”€ binning/                             # æ•°æ®åˆ†ç®±
â”‚   â”œâ”€â”€ quantile_binning_task.py         # ç­‰é¢‘åˆ†ç®±
â”‚   â””â”€â”€ equal_width_binning_task.py      # ç­‰å®½åˆ†ç®±
â””â”€â”€ fillna/                              # ç¼ºå¤±å€¼å¡«å……
    â””â”€â”€ fillna_task.py
```

### å®ç°çš„ä»»åŠ¡

| ä»»åŠ¡ | æ³¨å†Œåç§° | åŠŸèƒ½ | çŠ¶æ€ |
|-----|---------|------|------|
| StandardScaler | `standard_scaler` | æ ‡å‡†åŒ–ï¼ˆå‡å€¼0ï¼Œæ ‡å‡†å·®1ï¼‰ | âœ… |
| MinMaxScaler | `minmax_scaler` | å½’ä¸€åŒ–ï¼ˆç¼©æ”¾åˆ°æŒ‡å®šèŒƒå›´ï¼‰ | âœ… |
| LabelEncoder | `label_encoder` | æ ‡ç­¾ç¼–ç ï¼ˆç±»åˆ«â†’æ•°å€¼ï¼‰ | âœ… |
| OneHotEncoder | `onehot_encoder` | ç‹¬çƒ­ç¼–ç ï¼ˆç±»åˆ«â†’äºŒè¿›åˆ¶å‘é‡ï¼‰ | âœ… |
| QuantileBinning | `quantile_binning` | ç­‰é¢‘åˆ†ç®± | âœ… |
| EqualWidthBinning | `equal_width_binning` | ç­‰å®½åˆ†ç®± | âœ… |
| FillNA | `fillna` | ç¼ºå¤±å€¼å¡«å…… | âœ… |

**ä»£ç ç»Ÿè®¡**: 12ä¸ªæ–°æ–‡ä»¶ï¼Œçº¦1,114è¡Œä»£ç 

## äºŒã€Statsç»Ÿè®¡åˆ†æä»»åŠ¡æ¨¡å—é‡æ„

### é‡æ„æˆæœ

åˆ›å»ºäº†ç‹¬ç«‹çš„statsç»Ÿè®¡åˆ†ææ¨¡å—ï¼Œå®ç°äº†3ä¸ªç»Ÿè®¡åˆ†æä»»åŠ¡ï¼š

```
src/secretflow_task/jobs/stats/
â”œâ”€â”€ table_statistics_task.py             # è¡¨ç»Ÿè®¡åˆ†æ
â”œâ”€â”€ pearson_correlation_task.py          # Pearsonç›¸å…³æ€§åˆ†æ
â””â”€â”€ vif_task.py                          # æ–¹å·®è†¨èƒ€å› å­
```

### å®ç°çš„ä»»åŠ¡

| ä»»åŠ¡ | æ³¨å†Œåç§° | SecretFlow API | åŠŸèƒ½ | çŠ¶æ€ |
|-----|---------|---------------|------|------|
| TableStatistics | `table_statistics` | `table_statistics` | è¡¨ç»Ÿè®¡ä¿¡æ¯ | âœ… |
| PearsonCorrelation | `pearson_correlation` | `SSVertPearsonR` | Pearsonç›¸å…³ç³»æ•°çŸ©é˜µ | âœ… |
| VIF | `vif` | `SSVertVIF` | æ–¹å·®è†¨èƒ€å› å­ | âœ… |

**ä»£ç ç»Ÿè®¡**: 3ä¸ªæ–°æ–‡ä»¶ï¼Œçº¦378è¡Œä»£ç 

## ä¸‰ã€Evaluationæ¨¡å‹è¯„ä¼°ä»»åŠ¡æ¨¡å—é‡æ„

### é‡æ„æˆæœ

åˆ›å»ºäº†ç‹¬ç«‹çš„evaluationæ¨¡å‹è¯„ä¼°æ¨¡å—ï¼Œå®ç°äº†2ä¸ªè¯„ä¼°ä»»åŠ¡ï¼š

```
src/secretflow_task/jobs/evaluation/
â”œâ”€â”€ biclassification_eval_task.py        # äºŒåˆ†ç±»è¯„ä¼°
â””â”€â”€ regression_eval_task.py              # å›å½’è¯„ä¼°
```

### å®ç°çš„ä»»åŠ¡

| ä»»åŠ¡ | æ³¨å†Œåç§° | SecretFlow API | è¯„ä¼°æŒ‡æ ‡ | çŠ¶æ€ |
|-----|---------|---------------|---------|------|
| BiClassificationEval | `biclassification_eval` | `BiClassificationEval` | AUCã€KSã€F1ã€Precisionã€Recallã€Accuracy | âœ… |
| RegressionEval | `regression_eval` | `RegressionEval` | MSEã€RMSEã€MAEã€MAPEã€RÂ²ã€Explained Variance | âœ… |

**ä»£ç ç»Ÿè®¡**: 2ä¸ªæ–°æ–‡ä»¶ï¼Œçº¦296è¡Œä»£ç 

## å››ã€Testsæµ‹è¯•ç›®å½•é‡æ„

### é‡æ„æˆæœ

åˆ›å»ºäº†æ¨¡å—åŒ–çš„æµ‹è¯•ç›®å½•ç»“æ„ï¼Œä¸æºä»£ç ç»“æ„ä¿æŒä¸€è‡´ï¼š

```
tests/
â”œâ”€â”€ README.md                            # æµ‹è¯•è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ unit/                                # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ jobs/                            # Jobsä»»åŠ¡æµ‹è¯•
â”‚       â”œâ”€â”€ test_psi_task.py             # PSIä»»åŠ¡æµ‹è¯•
â”‚       â”œâ”€â”€ linear/                      # Linearæ¨¡å‹æµ‹è¯•
â”‚       â”‚   â””â”€â”€ test_ss_lr_task.py
â”‚       â”œâ”€â”€ boost/                       # Boostæ¨¡å‹æµ‹è¯•
â”‚       â”‚   â””â”€â”€ test_ss_xgb_task.py
â”‚       â”œâ”€â”€ preprocessing/               # é¢„å¤„ç†ä»»åŠ¡æµ‹è¯•
â”‚       â”‚   â”œâ”€â”€ test_scaler_tasks.py
â”‚       â”‚   â””â”€â”€ test_encoder_tasks.py
â”‚       â”œâ”€â”€ stats/                       # ç»Ÿè®¡åˆ†æä»»åŠ¡æµ‹è¯•
â”‚       â”‚   â”œâ”€â”€ test_table_statistics_task.py
â”‚       â”‚   â”œâ”€â”€ test_pearson_correlation_task.py
â”‚       â”‚   â””â”€â”€ test_vif_task.py
â”‚       â””â”€â”€ evaluation/                  # æ¨¡å‹è¯„ä¼°ä»»åŠ¡æµ‹è¯•
â”‚           â”œâ”€â”€ test_biclassification_eval_task.py
â”‚           â””â”€â”€ test_regression_eval_task.py
â””â”€â”€ integration/                         # é›†æˆæµ‹è¯•
    â””â”€â”€ test_ml_workflow.py              # å®Œæ•´MLå·¥ä½œæµæµ‹è¯•
```

### åˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶

**å•å…ƒæµ‹è¯•**: 11ä¸ªæµ‹è¯•æ–‡ä»¶
**é›†æˆæµ‹è¯•**: 1ä¸ªå®Œæ•´å·¥ä½œæµæµ‹è¯•
**æ–‡æ¡£**: 1ä¸ªREADME.mdè¯´æ˜æ–‡æ¡£

**ä»£ç ç»Ÿè®¡**: 13ä¸ªæ–°æ–‡ä»¶ï¼Œçº¦1,500è¡Œæµ‹è¯•ä»£ç 

## æ€»ä½“ç»Ÿè®¡

### ä»£ç å˜æ›´

| æ¨¡å— | æ–°å»ºæ–‡ä»¶ | ä»£ç è¡Œæ•° | è¯´æ˜ |
|-----|---------|---------|------|
| Preprocessing | 12 | ~1,114 | é¢„å¤„ç†ä»»åŠ¡ |
| Stats | 3 | ~378 | ç»Ÿè®¡åˆ†æä»»åŠ¡ |
| Evaluation | 2 | ~296 | æ¨¡å‹è¯„ä¼°ä»»åŠ¡ |
| Tests | 13 | ~1,500 | æµ‹è¯•ä»£ç  |
| **æ€»è®¡** | **30** | **~3,288** | **æ–°å¢ä»£ç ** |

### æ–‡æ¡£åˆ›å»º

| æ–‡æ¡£ | è¯´æ˜ |
|-----|------|
| `preprocessing_refactoring.md` | é¢„å¤„ç†ä»»åŠ¡é‡æ„æ€»ç»“ |
| `stats_evaluation_refactoring.md` | Statså’ŒEvaluationé‡æ„æ€»ç»“ |
| `tests_refactoring.md` | Testsç›®å½•é‡æ„æ€»ç»“ |
| `tests/README.md` | æµ‹è¯•è¯´æ˜æ–‡æ¡£ |
| `complete_refactoring_summary.md` | å®Œæ•´é‡æ„æ€»ç»“ï¼ˆæœ¬æ–‡æ¡£ï¼‰ |

## æ ¸å¿ƒç‰¹æ€§

### 1. æ¨¡å—åŒ–è®¾è®¡

- âœ… æŒ‰åŠŸèƒ½åˆ†ç±»ç»„ç»‡ä»£ç 
- âœ… æ¯ä¸ªä»»åŠ¡ç‹¬ç«‹æ–‡ä»¶
- âœ… æ¸…æ™°çš„æ¨¡å—å¯¼å‡º
- âœ… æ˜“äºæŸ¥æ‰¾å’Œç»´æŠ¤

### 2. ç›´æ¥ä½¿ç”¨SecretFlow API

- âœ… æ‰€æœ‰ä»»åŠ¡ç›´æ¥è°ƒç”¨SecretFlowæä¾›çš„API
- âœ… æ— éœ€é‡å¤å®ç°å·²æœ‰åŠŸèƒ½
- âœ… ä¿è¯åŠŸèƒ½æ­£ç¡®æ€§å’Œæ€§èƒ½
- âœ… ä¸SecretFlowä¿æŒä¸€è‡´

### 3. ç»Ÿä¸€çš„ä»£ç é£æ ¼

- âœ… ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿï¼ˆloguruï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… æ¸…æ™°çš„æ–‡æ¡£æ³¨é‡Š
- âœ… ä¸€è‡´çš„æ¥å£è®¾è®¡

### 4. å®Œå–„çš„æµ‹è¯•ä½“ç³»

- âœ… æµ‹è¯•ç»“æ„ä¸æºä»£ç ç»“æ„å¯¹åº”
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰ä»»åŠ¡
- âœ… é›†æˆæµ‹è¯•éªŒè¯å®Œæ•´å·¥ä½œæµ
- âœ… è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£

## æŠ€æœ¯äº®ç‚¹

### 1. ä»»åŠ¡æ³¨å†Œæœºåˆ¶

æ‰€æœ‰ä»»åŠ¡ä½¿ç”¨è£…é¥°å™¨è‡ªåŠ¨æ³¨å†Œï¼š

```python
@TaskDispatcher.register_task("table_statistics")
def execute_table_statistics(devices: Dict[str, PYU], task_config: Dict) -> Dict:
    """æ‰§è¡Œè¡¨ç»Ÿè®¡åˆ†æä»»åŠ¡"""
    pass
```

### 2. å‚ç›´è”é‚¦å­¦ä¹ æ”¯æŒ

æ‰€æœ‰ä»»åŠ¡æ”¯æŒå‚ç›´åˆ†åŒºæ•°æ®ï¼š

```python
# è¯»å–å‚ç›´åˆ†åŒºæ•°æ®
pyu_input_paths = {devices[party]: input_data[party] for party in parties}
vdf: VDataFrame = sf.data.vertical.read_csv(pyu_input_paths)
```

### 3. JSONç»“æœåºåˆ—åŒ–

ç»Ÿè®¡å’Œè¯„ä¼°ç»“æœä¿å­˜ä¸ºJSONæ ¼å¼ï¼š

```python
with open(output_report, 'w', encoding='utf-8') as f:
    json.dump(result_dict, f, indent=2, ensure_ascii=False)
```

### 4. å®Œæ•´çš„å·¥ä½œæµæµ‹è¯•

é›†æˆæµ‹è¯•è¦†ç›–å®Œæ•´çš„MLå·¥ä½œæµï¼š

```
PSI â†’ Preprocessing â†’ Stats â†’ Training â†’ Prediction â†’ Evaluation
```

## ä½¿ç”¨ç¤ºä¾‹

### é¢„å¤„ç†ä»»åŠ¡

```python
# StandardScaleræ ‡å‡†åŒ–
task_config = {
    "input_data": {"alice": "alice.csv", "bob": "bob.csv"},
    "output_data": {"alice": "alice_scaled.csv", "bob": "bob_scaled.csv"},
    "columns": ["age", "income"],
    "with_mean": True,
    "with_std": True,
}
result = TaskDispatcher.dispatch("standard_scaler", devices, task_config)
```

### ç»Ÿè®¡åˆ†æä»»åŠ¡

```python
# è¡¨ç»Ÿè®¡åˆ†æ
task_config = {
    "input_data": {"alice": "alice.csv", "bob": "bob.csv"},
    "output_report": "stats_report.json",
    "columns": ["age", "income"],
}
result = TaskDispatcher.dispatch("table_statistics", devices, task_config)
```

### æ¨¡å‹è¯„ä¼°ä»»åŠ¡

```python
# äºŒåˆ†ç±»è¯„ä¼°
task_config = {
    "prediction_data": {"alice": "predictions.csv"},
    "label_column": "label",
    "prediction_column": "probability",
    "output_report": "eval_report.json",
}
result = TaskDispatcher.dispatch("biclassification_eval", devices, task_config)
```

## åç»­å·¥ä½œ

### å¾…å®Œæˆ

- â³ ä¸ºæ‰€æœ‰ä»»åŠ¡æ·»åŠ å•å…ƒæµ‹è¯•
- â³ åˆ é™¤æ—§çš„æµ‹è¯•æ–‡ä»¶
- â³ æ·»åŠ WOE/IVè®¡ç®—ä»»åŠ¡
- â³ æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•åœºæ™¯
- â³ å®Œå–„æµ‹è¯•è¦†ç›–ç‡

### æ‰©å±•æ–¹å‘

1. **æ›´å¤šé¢„å¤„ç†ä»»åŠ¡**: RobustScalerã€MaxAbsScalerã€TargetEncoderç­‰
2. **æ›´å¤šç»Ÿè®¡åˆ†æ**: P-Valueã€GroupByç»Ÿè®¡ã€PSIè¯„ä¼°ç­‰
3. **æ›´å¤šè¯„ä¼°æŒ‡æ ‡**: è‡ªå®šä¹‰è¯„ä¼°æŒ‡æ ‡ã€å¤šåˆ†ç±»è¯„ä¼°ç­‰
4. **æ€§èƒ½ä¼˜åŒ–**: å¤§æ•°æ®é›†å¤„ç†ä¼˜åŒ–
5. **æ–‡æ¡£å®Œå–„**: APIæ–‡æ¡£ã€ä½¿ç”¨æ•™ç¨‹ã€æœ€ä½³å®è·µ

## æ€»ç»“

### é‡æ„æˆæœ

1. âœ… **ç›®å½•ç»“æ„æ¸…æ™°**
   - æŒ‰åŠŸèƒ½åˆ†ç±»ç»„ç»‡
   - æ¨¡å—åŒ–è®¾è®¡
   - æ˜“äºç»´æŠ¤å’Œæ‰©å±•

2. âœ… **åŠŸèƒ½å®Œæ•´**
   - 12ä¸ªä»»åŠ¡æ¨¡å—
   - è¦†ç›–å¸¸ç”¨åœºæ™¯
   - ç›´æ¥ä½¿ç”¨SecretFlow API

3. âœ… **ä»£ç è´¨é‡é«˜**
   - ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
   - å®Œæ•´çš„é”™è¯¯å¤„ç†
   - æ¸…æ™°çš„æ–‡æ¡£æ³¨é‡Š

4. âœ… **æµ‹è¯•ä½“ç³»å®Œå–„**
   - æ¨¡å—åŒ–æµ‹è¯•ç»“æ„
   - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - è¯¦ç»†çš„æµ‹è¯•æ–‡æ¡£

### æ ¸å¿ƒä»·å€¼

**ä»å•æ–‡ä»¶åˆ°æ¨¡å—åŒ–**:
- æ›´å¥½çš„ä»£ç ç»„ç»‡
- æ›´å®¹æ˜“ç»´æŠ¤
- æ›´æ–¹ä¾¿æ‰©å±•
- æ›´ç¬¦åˆå·¥ç¨‹è§„èŒƒ

**ä»ç©ºå®ç°åˆ°å®Œæ•´åŠŸèƒ½**:
- å®ç°äº†12ä¸ªæ ¸å¿ƒä»»åŠ¡
- ç›´æ¥ä½¿ç”¨SecretFlowæˆç†ŸAPI
- ä¿è¯åŠŸèƒ½æ­£ç¡®æ€§å’Œæ€§èƒ½

**ä»æ— æµ‹è¯•åˆ°å®Œå–„æµ‹è¯•**:
- åˆ›å»ºäº†æ¨¡å—åŒ–æµ‹è¯•ç»“æ„
- è¦†ç›–æ‰€æœ‰æ ¸å¿ƒä»»åŠ¡
- æä¾›å®Œæ•´å·¥ä½œæµæµ‹è¯•

## é¡¹ç›®çŠ¶æ€

### å·²å®ç°çš„ä»»åŠ¡æ¨¡å—

| æ¨¡å— | ä»»åŠ¡æ•°é‡ | çŠ¶æ€ |
|-----|---------|------|
| PSI | 1 | âœ… |
| Linear | 2 | âœ… |
| Boost | 2 | âœ… |
| Preprocessing | 7 | âœ… |
| Stats | 3 | âœ… |
| Evaluation | 2 | âœ… |
| **æ€»è®¡** | **17** | **âœ…** |

### æµ‹è¯•è¦†ç›–

| æµ‹è¯•ç±»å‹ | æ•°é‡ | çŠ¶æ€ |
|---------|------|------|
| å•å…ƒæµ‹è¯• | 11 | âœ… |
| é›†æˆæµ‹è¯• | 1 | âœ… |
| **æ€»è®¡** | **12** | **âœ…** |

**SecretFlowä»»åŠ¡æ¨¡å—é‡æ„å®Œæˆï¼** ğŸ‰

---

**é‡æ„æ—¶é—´**: 2026-01-05  
**æ€»ä»£ç é‡**: ~3,288è¡Œ  
**æ–°å»ºæ–‡ä»¶**: 30ä¸ª  
**æ–‡æ¡£æ•°é‡**: 5ä¸ª
