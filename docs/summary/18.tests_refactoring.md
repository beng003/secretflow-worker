# Testsç›®å½•é‡æ„æ€»ç»“

## é‡æ„æ¦‚è¿°

**å®Œæˆæ—¥æœŸ**: 2026-01-05  
**ç›®æ ‡**: é‡æ„testsç›®å½•ç»“æ„ï¼Œå‚è€ƒsrc/secretflow_taskçš„æ¨¡å—åŒ–ç»„ç»‡ï¼Œä½¿æµ‹è¯•ç»“æ„ä¸æºä»£ç ç»“æ„ä¿æŒä¸€è‡´

## é‡æ„åŠ¨æœº

### åŸæœ‰é—®é¢˜

1. **æ‰å¹³åŒ–ç»“æ„**: æ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½åœ¨`tests/unit`ç›®å½•ä¸‹ï¼Œç¼ºä¹å±‚æ¬¡ç»“æ„
2. **ä¸æ˜“ç»´æŠ¤**: éšç€ä»»åŠ¡æ¨¡å—å¢å¤šï¼Œæµ‹è¯•æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤šï¼Œéš¾ä»¥ç®¡ç†
3. **ç»“æ„ä¸ä¸€è‡´**: æµ‹è¯•ç›®å½•ç»“æ„ä¸æºä»£ç ç›®å½•ç»“æ„ä¸å¯¹åº”

### è§£å†³æ–¹æ¡ˆ

å‚è€ƒ`src/secretflow_task/jobs`çš„æ¨¡å—åŒ–ç»“æ„ï¼Œåˆ›å»ºå¯¹åº”çš„æµ‹è¯•å­ç›®å½•ï¼š
- æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡æµ‹è¯•æ–‡ä»¶
- æµ‹è¯•ç›®å½•ç»“æ„ä¸æºä»£ç ç›®å½•ç»“æ„ä¸€ä¸€å¯¹åº”
- ä¾¿äºæŸ¥æ‰¾å’Œç»´æŠ¤

## æ–°çš„ç›®å½•ç»“æ„

### é‡æ„å‰

```
tests/
â”œâ”€â”€ conftest.py
â”œâ”€â”€ data/                    # æµ‹è¯•æ•°æ®
â”œâ”€â”€ models/                  # æµ‹è¯•æ¨¡å‹
â”œâ”€â”€ no_pytest/               # épytestæµ‹è¯•
â””â”€â”€ unit/                    # å•å…ƒæµ‹è¯•
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_ml_task.py              # MLä»»åŠ¡æµ‹è¯•ï¼ˆæ··åˆï¼‰
    â”œâ”€â”€ test_preprocessing_task.py   # é¢„å¤„ç†ä»»åŠ¡æµ‹è¯•ï¼ˆæ··åˆï¼‰
    â”œâ”€â”€ test_psi_task.py             # PSIä»»åŠ¡æµ‹è¯•
    â””â”€â”€ test_task_dispatcher.py      # ä»»åŠ¡åˆ†å‘å™¨æµ‹è¯•
```

### é‡æ„å

```
tests/
â”œâ”€â”€ conftest.py
â”œâ”€â”€ data/                    # æµ‹è¯•æ•°æ®
â”œâ”€â”€ models/                  # æµ‹è¯•æ¨¡å‹
â”œâ”€â”€ no_pytest/               # épytestæµ‹è¯•
â””â”€â”€ unit/                    # å•å…ƒæµ‹è¯•
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_task_dispatcher.py      # ä»»åŠ¡åˆ†å‘å™¨æµ‹è¯•ï¼ˆä¿ç•™ï¼‰
    â””â”€â”€ jobs/                         # Jobsä»»åŠ¡æµ‹è¯•ï¼ˆæ–°å¢ï¼‰
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ test_psi_task.py          # PSIä»»åŠ¡æµ‹è¯•
        â”œâ”€â”€ linear/                   # Linearæ¨¡å‹æµ‹è¯•
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ test_ss_lr_task.py    # SS-LRä»»åŠ¡æµ‹è¯•
        â”œâ”€â”€ boost/                    # Boostæ¨¡å‹æµ‹è¯•
        â”‚   â””â”€â”€ __init__.py
        â”œâ”€â”€ preprocessing/            # é¢„å¤„ç†ä»»åŠ¡æµ‹è¯•
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ test_scaler_tasks.py  # Scalerä»»åŠ¡æµ‹è¯•
        â”œâ”€â”€ stats/                    # ç»Ÿè®¡åˆ†æä»»åŠ¡æµ‹è¯•
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â””â”€â”€ test_table_statistics_task.py
        â””â”€â”€ evaluation/               # æ¨¡å‹è¯„ä¼°ä»»åŠ¡æµ‹è¯•
            â”œâ”€â”€ __init__.py
            â””â”€â”€ test_biclassification_eval_task.py
```

## ç›®å½•ç»“æ„å¯¹åº”å…³ç³»

| æºä»£ç ç›®å½• | æµ‹è¯•ç›®å½• | è¯´æ˜ |
|-----------|---------|------|
| `src/secretflow_task/jobs/` | `tests/unit/jobs/` | Jobsä»»åŠ¡æ¨¡å— |
| `src/secretflow_task/jobs/psi_task.py` | `tests/unit/jobs/test_psi_task.py` | PSIä»»åŠ¡ |
| `src/secretflow_task/jobs/linear/` | `tests/unit/jobs/linear/` | Linearæ¨¡å‹ |
| `src/secretflow_task/jobs/boost/` | `tests/unit/jobs/boost/` | Boostæ¨¡å‹ |
| `src/secretflow_task/jobs/preprocessing/` | `tests/unit/jobs/preprocessing/` | é¢„å¤„ç†ä»»åŠ¡ |
| `src/secretflow_task/jobs/stats/` | `tests/unit/jobs/stats/` | ç»Ÿè®¡åˆ†æä»»åŠ¡ |
| `src/secretflow_task/jobs/evaluation/` | `tests/unit/jobs/evaluation/` | æ¨¡å‹è¯„ä¼°ä»»åŠ¡ |

## å·²åˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶

### 1. Jobsä»»åŠ¡æµ‹è¯•åŸºç¡€ç»“æ„

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `tests/unit/jobs/__init__.py` | Jobsæµ‹è¯•æ¨¡å—åˆå§‹åŒ– |
| `tests/unit/jobs/test_psi_task.py` | PSIä»»åŠ¡æµ‹è¯• |

### 2. Linearæ¨¡å‹æµ‹è¯•

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `tests/unit/jobs/linear/__init__.py` | Linearæµ‹è¯•æ¨¡å—åˆå§‹åŒ– |
| `tests/unit/jobs/linear/test_ss_lr_task.py` | SS-LRè®­ç»ƒå’Œé¢„æµ‹æµ‹è¯• |

### 3. Boostæ¨¡å‹æµ‹è¯•

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `tests/unit/jobs/boost/__init__.py` | Boostæµ‹è¯•æ¨¡å—åˆå§‹åŒ– |

### 4. Preprocessingé¢„å¤„ç†æµ‹è¯•

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `tests/unit/jobs/preprocessing/__init__.py` | Preprocessingæµ‹è¯•æ¨¡å—åˆå§‹åŒ– |
| `tests/unit/jobs/preprocessing/test_scaler_tasks.py` | StandardScalerå’ŒMinMaxScaleræµ‹è¯• |

### 5. Statsç»Ÿè®¡åˆ†ææµ‹è¯•

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `tests/unit/jobs/stats/__init__.py` | Statsæµ‹è¯•æ¨¡å—åˆå§‹åŒ– |
| `tests/unit/jobs/stats/test_table_statistics_task.py` | è¡¨ç»Ÿè®¡ä»»åŠ¡æµ‹è¯• |

### 6. Evaluationæ¨¡å‹è¯„ä¼°æµ‹è¯•

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `tests/unit/jobs/evaluation/__init__.py` | Evaluationæµ‹è¯•æ¨¡å—åˆå§‹åŒ– |
| `tests/unit/jobs/evaluation/test_biclassification_eval_task.py` | äºŒåˆ†ç±»è¯„ä¼°ä»»åŠ¡æµ‹è¯• |

## æµ‹è¯•æ–‡ä»¶ç¤ºä¾‹

### SS-LRä»»åŠ¡æµ‹è¯•ç¤ºä¾‹

```python
# tests/unit/jobs/linear/test_ss_lr_task.py
from secretflow_task.jobs.linear.ss_lr_task import load_ss_lr_model
from secretflow_task.task_dispatcher import TaskDispatcher

def test_ss_lr_train(setup_devices, prepare_test_data):
    """æµ‹è¯•SS-LRè®­ç»ƒä»»åŠ¡"""
    task_config = {
        "train_data": {...},
        "model_output": {...},
        "features": [...],
        "label": "label",
        ...
    }
    
    result = TaskDispatcher.dispatch("ss_logistic_regression", devices, task_config)
    assert result is not None
    assert result["secure_mode"] is True
```

### è¡¨ç»Ÿè®¡ä»»åŠ¡æµ‹è¯•ç¤ºä¾‹

```python
# tests/unit/jobs/stats/test_table_statistics_task.py
def test_table_statistics(setup_devices, prepare_test_data):
    """æµ‹è¯•è¡¨ç»Ÿè®¡ä»»åŠ¡"""
    task_config = {
        "input_data": data_paths,
        "output_report": "stats_report.json",
        "columns": ["age", "income"],
    }
    
    result = TaskDispatcher.dispatch("table_statistics", devices, task_config)
    assert result["num_columns"] == 2
```

## æµ‹è¯•ç»„ç»‡åŸåˆ™

### 1. æ¨¡å—åŒ–ç»„ç»‡

- æ¯ä¸ªåŠŸèƒ½æ¨¡å—æœ‰ç‹¬ç«‹çš„æµ‹è¯•ç›®å½•
- æµ‹è¯•ç›®å½•ç»“æ„ä¸æºä»£ç ç›®å½•ç»“æ„å¯¹åº”
- ä¾¿äºæŸ¥æ‰¾å’Œç»´æŠ¤

### 2. æµ‹è¯•æ–‡ä»¶å‘½å

- æµ‹è¯•æ–‡ä»¶ä»¥`test_`å¼€å¤´
- æ–‡ä»¶åä¸è¢«æµ‹è¯•çš„æºæ–‡ä»¶å¯¹åº”
- ä¾‹å¦‚ï¼š`ss_lr_task.py` â†’ `test_ss_lr_task.py`

### 3. Fixtureå…±äº«

- ä½¿ç”¨`conftest.py`å®šä¹‰å…±äº«çš„fixture
- æ¯ä¸ªæµ‹è¯•æ¨¡å—å¯ä»¥æœ‰è‡ªå·±çš„fixture
- é¿å…é‡å¤ä»£ç 

### 4. æµ‹è¯•æ•°æ®ç®¡ç†

- ç»Ÿä¸€ä½¿ç”¨`tests/data`ç›®å½•å­˜æ”¾æµ‹è¯•æ•°æ®
- æµ‹è¯•æ¨¡å‹ç»Ÿä¸€å­˜æ”¾åœ¨`tests/models`ç›®å½•
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨æµ‹è¯•æ•°æ®

## è¿ç§»è®¡åˆ’

### å·²å®Œæˆ

- âœ… åˆ›å»ºæ–°çš„testsç›®å½•ç»“æ„
- âœ… åˆ›å»ºjobsæµ‹è¯•å­æ¨¡å—
- âœ… åˆ›å»ºlinearæµ‹è¯•æ¨¡å—ï¼ˆtest_ss_lr_task.pyï¼‰
- âœ… åˆ›å»ºboostæµ‹è¯•æ¨¡å—ï¼ˆtest_ss_xgb_task.pyï¼‰
- âœ… åˆ›å»ºpreprocessingæµ‹è¯•æ¨¡å—
  - test_scaler_tasks.pyï¼ˆStandardScalerã€MinMaxScalerï¼‰
  - test_encoder_tasks.pyï¼ˆLabelEncoderã€OneHotEncoderï¼‰
- âœ… åˆ›å»ºstatsæµ‹è¯•æ¨¡å—
  - test_table_statistics_task.py
  - test_pearson_correlation_task.py
  - test_vif_task.py
- âœ… åˆ›å»ºevaluationæµ‹è¯•æ¨¡å—
  - test_biclassification_eval_task.py
  - test_regression_eval_task.py
- âœ… è¿ç§»PSIä»»åŠ¡æµ‹è¯•
- âœ… åˆ›å»ºé›†æˆæµ‹è¯•ç›®å½•å’Œå®Œæ•´å·¥ä½œæµæµ‹è¯•
- âœ… åˆ›å»ºtests/README.mdè¯´æ˜æ–‡æ¡£

### å¾…å®Œæˆ

- â³ åˆ é™¤æˆ–é‡å‘½åæ—§çš„æµ‹è¯•æ–‡ä»¶ï¼ˆtest_ml_task.pyã€test_preprocessing_task.pyï¼‰
- â³ æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•åœºæ™¯
- â³ å®Œå–„æµ‹è¯•è¦†ç›–ç‡

## è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
pytest tests/unit/
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•

```bash
# è¿è¡ŒLinearæ¨¡å‹æµ‹è¯•
pytest tests/unit/jobs/linear/

# è¿è¡ŒPreprocessingæµ‹è¯•
pytest tests/unit/jobs/preprocessing/

# è¿è¡ŒStatsæµ‹è¯•
pytest tests/unit/jobs/stats/

# è¿è¡ŒEvaluationæµ‹è¯•
pytest tests/unit/jobs/evaluation/
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶

```bash
# è¿è¡ŒSS-LRæµ‹è¯•
pytest tests/unit/jobs/linear/test_ss_lr_task.py

# è¿è¡Œè¡¨ç»Ÿè®¡æµ‹è¯•
pytest tests/unit/jobs/stats/test_table_statistics_task.py
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å‡½æ•°

```bash
# è¿è¡ŒSS-LRè®­ç»ƒæµ‹è¯•
pytest tests/unit/jobs/linear/test_ss_lr_task.py::test_ss_lr_train

# è¿è¡Œè¡¨ç»Ÿè®¡æµ‹è¯•
pytest tests/unit/jobs/stats/test_table_statistics_task.py::test_table_statistics
```

## æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»

- æ¯ä¸ªæµ‹è¯•å‡½æ•°ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨fixtureå‡†å¤‡å’Œæ¸…ç†æµ‹è¯•ç¯å¢ƒ
- é¿å…æµ‹è¯•ä¹‹é—´çš„ä¾èµ–

### 2. æµ‹è¯•æ•°æ®

- ä½¿ç”¨å°è§„æ¨¡æµ‹è¯•æ•°æ®
- æµ‹è¯•æ•°æ®åº”è¯¥å¯é‡ç°
- ä½¿ç”¨å›ºå®šçš„éšæœºç§å­

### 3. æ–­è¨€æ¸…æ™°

- ä½¿ç”¨æ˜ç¡®çš„æ–­è¨€è¯­å¥
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯
- æµ‹è¯•å…³é”®åŠŸèƒ½ç‚¹

### 4. æµ‹è¯•è¦†ç›–

- æµ‹è¯•æ­£å¸¸æµç¨‹
- æµ‹è¯•å¼‚å¸¸æƒ…å†µ
- æµ‹è¯•è¾¹ç•Œæ¡ä»¶

## æ€»ç»“

### é‡æ„æˆæœ

1. âœ… **ç›®å½•ç»“æ„æ¸…æ™°**
   - æµ‹è¯•ç›®å½•ä¸æºä»£ç ç›®å½•å¯¹åº”
   - æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡
   - æ˜“äºæŸ¥æ‰¾å’Œç»´æŠ¤

2. âœ… **æ¨¡å—åŒ–æµ‹è¯•**
   - æ¯ä¸ªåŠŸèƒ½æ¨¡å—ç‹¬ç«‹æµ‹è¯•
   - æµ‹è¯•æ–‡ä»¶èŒè´£å•ä¸€
   - ä¾¿äºæ‰©å±•

3. âœ… **æµ‹è¯•åŸºç¡€å®Œå–„**
   - åˆ›å»ºäº†åŸºç¡€æµ‹è¯•æ–‡ä»¶
   - æä¾›äº†æµ‹è¯•ç¤ºä¾‹
   - ç»Ÿä¸€çš„æµ‹è¯•é£æ ¼

4. âœ… **æ˜“äºç»´æŠ¤**
   - ç»“æ„æ¸…æ™°
   - å‘½åè§„èŒƒ
   - ä¾¿äºåä½œ

### æ ¸å¿ƒä¼˜åŠ¿

**ä»æ‰å¹³åŒ–åˆ°æ¨¡å—åŒ–**:
- æµ‹è¯•ç»“æ„ä¸æºä»£ç ç»“æ„ä¸€è‡´
- ä¾¿äºæŸ¥æ‰¾å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶
- æ”¯æŒæ¨¡å—åŒ–æµ‹è¯•è¿è¡Œ
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤

**Testsç›®å½•é‡æ„å®Œæˆï¼** ğŸ‰
