# ========================================
# SecretFlow生产环境配置模板 (Host网络模式)
# ========================================

# ========== 节点基础配置 ==========
# 节点唯一标识符
NODE_ID=node1

# 节点IP地址（宿主机真实IP，用于Ray集群和SecretFlow通信）
NODE_IP=211.87.232.108

# 运行环境
APP_ENV=development

# ========== Redis配置 ==========
# Redis连接URL（host模式下使用127.0.0.1）
REDIS_URL=redis://127.0.0.1:16379/0

# Redis密码（可选，生产环境建议设置）
REDIS_PASSWORD=

# ========== Ray集群配置 ==========
# 注意：每个节点都启动独立的Ray集群，不需要配置worker节点
# 多节点部署时，各节点通过SecretFlow的cluster_config进行通信

# Ray GCS端口（参考值，实际端口由Ray自动选择）
RAY_PORT=61379

# Ray使用的CPU数量（0表示使用全部CPU）
RAY_NUM_CPUS=0

# Ray对象存储内存大小（字节）
RAY_OBJECT_STORE_MEMORY=2000000000

# ========== SecretFlow端口范围配置 ==========
# SecretFlow通信端口范围
# 注意：不同节点需要使用不同的端口范围避免冲突
# 节点1: 19000-19009
# 节点2: 19100-19109
# 节点3: 19200-19299
SF_PORT_RANGE_START=19000
SF_PORT_RANGE_END=19009

# SPU节点端口范围
SPU_PORT_RANGE_START=19500
SPU_PORT_RANGE_END=19509

# HEU节点端口范围（可选）
HEU_PORT_RANGE_START=19800
HEU_PORT_RANGE_END=19809

# ========== Celery Worker基础配置 ==========
# Worker并发数（建议设置为CPU核心数的1-2倍）
WORKER_CONCURRENCY=2

# Worker主机名
WORKER_HOSTNAME=${NODE_ID}@127.0.0.1

# Worker日志级别
CELERY_LOG_LEVEL=INFO

# Worker任务队列
WORKER_QUEUES=secretflow_queue

# ========== Celery Worker启动参数 ==========
# Worker池类型（prefork, solo, threads, gevent）
WORKER_POOL=prefork

# 每个子进程最大任务数
WORKER_MAX_TASKS_PER_CHILD=100

# 预取任务倍数
WORKER_PREFETCH_MULTIPLIER=1

# 任务确认延迟（秒）
WORKER_TASK_ACKS_LATE=true

# 任务拒绝时重新入队
WORKER_TASK_REJECT_ON_WORKER_LOST=true

# ========== Celery任务配置 ==========
# 任务软超时时间（秒）
WORKER_TASK_SOFT_TIME_LIMIT=3600

# 任务硬超时时间（秒）
WORKER_TASK_TIME_LIMIT=3900

# 任务结果过期时间（秒）
CELERY_RESULT_EXPIRES=86400

# 任务序列化格式
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json

# ========== Celery队列路由 ==========
# 默认队列
CELERY_DEFAULT_QUEUE=secretflow_queue
CELERY_DEFAULT_EXCHANGE=secretflow
CELERY_DEFAULT_EXCHANGE_TYPE=direct
CELERY_DEFAULT_ROUTING_KEY=secretflow

# ========== Celery Worker行为 ==========
# Worker优雅关闭超时（秒）
WORKER_SHUTDOWN_TIMEOUT=300

# Worker发送任务事件
WORKER_SEND_TASK_EVENTS=false

# 启用UTC时间
CELERY_ENABLE_UTC=true
CELERY_TIMEZONE=Asia/Shanghai

# ========== Celery监控端口 ==========
CELERY_MONITOR_PORT=8088

# ========== 任务状态通知配置 ==========
# 任务状态回调URL（可选，用于通知Web层）
TASK_STATUS_CALLBACK_URL=

# 任务状态回调超时（秒）
TASK_STATUS_CALLBACK_TIMEOUT=10

# ========== 日志配置 ==========
LOG_LEVEL=INFO
LOG_PATH=/app/logs

# ========== 数据目录 ==========
DATA_PATH=/app/data

# ========== SPU连接参数 ==========
# SPU协议类型（REF2K, SEMI2K, ABY3等）
SPU_PROTOCOL=SEMI2K

# SPU字段类型（FM32, FM64, FM128）
SPU_FIELD=FM64

# SPU启用TLS
SPU_ENABLE_TLS=false

# ========== 资源限制 ==========
# 最大内存使用（字节，0表示不限制）
MAX_MEMORY_BYTES=0

# 最大CPU使用率（0-100，0表示不限制）
MAX_CPU_PERCENT=0
