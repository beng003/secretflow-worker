# ============================================
# SecretFlow Worker 环境变量配置文件
# ============================================

# ========== 环境配置 ==========
# 调试模式开关：false=生产模式(性能优化)，true=开发模式(详细日志)
DEBUG=false
# 应用运行环境：development=开发环境，production=生产环境，testing=测试环境
APP_ENV=development

# ========== Redis 连接配置 ==========
# Redis完整连接URL，格式：redis://[用户名:密码@]主机:端口/数据库编号
# 包含所有连接信息：主机、端口、密码、数据库编号，无需重复配置
REDIS_URL=redis://secretflow-redis-test:6379/0
# 缓存过期时间（秒），3600秒=1小时
CACHE_TTL=3600

# ========== SecretFlow 节点配置 ==========
# Worker节点唯一标识符，用于在集群中识别不同的Worker节点
NODE_ID=secretflow-worker
# 节点IP地址，Worker对外通信的IP地址
NODE_IP=127.0.0.1
# 节点服务端口，Worker节点的HTTP服务端口
NODE_PORT=8088

# ========== Celery Worker 基础配置 ==========
# Worker并发进程数，同时运行的子进程数量，影响任务处理能力
CELERY_WORKER_CONCURRENCY=2
# Worker进程池类型：prefork=多进程池(适合CPU密集型)，thread=线程池，solo=单进程
CELERY_WORKER_POOL=prefork
# 自动扩缩容最大进程数
CELERY_WORKER_AUTOSCALE_MAX=4
# 自动扩缩容最小进程数
CELERY_WORKER_AUTOSCALE_MIN=2
# 最大同时执行任务数
MAX_CONCURRENT_TASKS=2

# ========== Celery Worker 启动参数配置 ==========
# 日志输出级别：DEBUG=最详细，INFO=一般信息，WARNING=警告，ERROR=仅错误
CELERY_LOG_LEVEL=INFO
# 每个子进程最大任务数，执行指定数量任务后重启子进程，防止内存泄漏
WORKER_MAX_TASKS_PER_CHILD=1
# 任务软超时时间（秒），1小时后发送SIGTERM信号警告
WORKER_TASK_SOFT_TIME_LIMIT=3600
# 任务硬超时时间（秒），65分钟后发送SIGKILL信号强制终止
WORKER_TASK_TIME_LIMIT=3900
# 预取任务倍数：1=每个进程同时只处理1个任务(串行执行)，防止SecretFlow任务间状态冲突
WORKER_PREFETCH_MULTIPLIER=1

# ========== Celery 任务配置 ==========
# 全局任务软超时时间（秒），任务执行超时警告时间
TASK_SOFT_TIME_LIMIT=3600
# 全局任务硬超时时间（秒），任务强制终止时间，2小时
TASK_TIME_LIMIT=7200
# 任务结果过期时间（秒），24小时后自动清理结果
RESULT_EXPIRES=86400
# 每个Worker子进程最大内存使用量（KB），200MB，超过后重启进程
WORKER_MAX_MEMORY_PER_CHILD=200000
# 应用时区设置，用于任务调度和日志时间
TIMEZONE=Asia/Shanghai

# ========== Celery 序列化和内容类型配置 ==========
# 任务序列化格式：json=JSON格式（推荐），pickle=Python对象序列化
TASK_SERIALIZER=json
# 结果序列化格式：json=JSON格式（推荐），pickle=Python对象序列化
RESULT_SERIALIZER=json
# 接受的内容类型，多个类型用逗号分隔，json=仅接受JSON格式
ACCEPT_CONTENT=json

# ========== Celery 队列和路由配置 ==========
# 默认任务队列名称，未指定队列的任务将路由到此队列
TASK_DEFAULT_QUEUE=secretflow_queue
# 默认任务交换器名称，与队列配置保持一致
TASK_DEFAULT_EXCHANGE=secretflow
# 默认路由键名称，用于消息路由规则
TASK_DEFAULT_ROUTING_KEY=secretflow

# ========== Celery Worker 行为配置 ==========
# 延迟确认模式：true=任务完成后确认，false=任务开始时确认（推荐true）
TASK_ACKS_LATE=true
# Worker断开时任务重新排队：true=重新排队，false=丢失任务（推荐true）
TASK_REJECT_ON_WORKER_LOST=true
# 跟踪任务开始状态：true=记录任务开始时间，false=不记录（影响性能）
TASK_TRACK_STARTED=true
# 禁用速率限制：true=禁用，false=启用（开发环境推荐true）
WORKER_DISABLE_RATE_LIMITS=true
# 发送任务事件：true=发送，false=不发送（监控时需要true）
WORKER_SEND_TASK_EVENTS=false
# 劫持根日志器：true=劫持，false=不劫持（与loguru兼容推荐false）
WORKER_HIJACK_ROOT_LOGGER=false
# Worker日志格式，与Celery内部日志格式保持一致
WORKER_LOG_FORMAT=[%(asctime)s: %(levelname)s/%(processName)s] %(message)s